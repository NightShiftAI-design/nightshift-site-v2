<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NightShift AI – Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<header>
    <nav>
        <h1 class="logo">NightShift <span>AI</span></h1>
        <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/pricing.html">Pricing</a></li>
            <li><a href="/faq.html">FAQ</a></li>
        </ul>
    </nav>
</header>

<div class="dashboard-container">

    <h1 style="text-align:center; margin-bottom: 40px;">Dashboard – Property Overview</h1>

    <!-- TOP STATS -->
    <div class="stats-box">

        <div class="stat-card">
            <h3>Total Reservations</h3>
            <p id="total-reservations">0</p>
        </div>

        <div class="stat-card">
            <h3>Total Calls</h3>
            <p id="total-calls">0</p>
        </div>

        <div class="stat-card">
            <h3>Avg Sentiment</h3>
            <p id="avg-sentiment">0</p>
        </div>

    </div>

    <!-- RESERVATIONS TABLE -->
    <div class="table-wrapper">
        <h2>Reservations</h2>
        <table id="reservations-table">
            <thead>
                <tr>
                    <th>Guest</th>
                    <th>Arrival</th>
                    <th>Nights</th>
                    <th>Room</th>
                    <th>Guests</th>
                    <th>Pets</th>
                    <th>Rate</th>
                    <th>Total Due</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- CALL LOGS TABLE -->
    <div class="table-wrapper">
        <h2>Call Logs</h2>
        <table id="calls-table">
            <thead>
                <tr>
                    <th>Caller</th>
                    <th>Reason</th>
                    <th>Arrival Date</th>
                    <th>Duration (s)</th>
                    <th>Sentiment</th>
                    <th>Tags</th>
                    <th>Risk Flags</th>
                    <th>Outcome</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</div>

<script>
// === SUPABASE FETCH LOGIC ===

// Replace with your real details
const SUPABASE_URL = "https://sbzdnzouoyxmawuhdvdi.supabase.co";
const SUPABASE_KEY = "<YOUR-SUPABASE-ANON-KEY-HERE>"; // Not service key!

// Fetch Reservations
async function loadReservations() {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/reservations?select=*`, {
        headers: {
            apikey: SUPABASE_KEY,
            Authorization: `Bearer ${SUPABASE_KEY}`
        }
    });

    const data = await res.json();

    const tableBody = document.querySelector("#reservations-table tbody");
    tableBody.innerHTML = "";

    data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.guest_name}</td>
            <td>${row.arrival_date}</td>
            <td>${row.nights}</td>
            <td>${row.room_type}</td>
            <td>${row.guests}</td>
            <td>${row.pets}</td>
            <td>$${row.rate_per_night}</td>
            <td>$${row.total_due}</td>
            <td>${row.notes ?? ""}</td>
        `;
        tableBody.appendChild(tr);
    });

    document.getElementById("total-reservations").textContent = data.length;
}


// Fetch Call Logs
async function loadCalls() {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/call_metadata?select=*`, {
        headers: {
            apikey: SUPABASE_KEY,
            Authorization: `Bearer ${SUPABASE_KEY}`
        }
    });

    const data = await res.json();

    const tableBody = document.querySelector("#calls-table tbody");
    tableBody.innerHTML = "";

    data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.caller_number ?? ""}</td>
            <td>${row.reason ?? ""}</td>
            <td>${row.arrival_date ?? ""}</td>
            <td>${row.duration_seconds ?? ""}</td>
            <td>${row.sentiment_score ?? ""}</td>
            <td>${row.tags ?? ""}</td>
            <td>${row.risk_flags ?? ""}</td>
            <td>${row.outcome ?? ""}</td>
        `;
        tableBody.appendChild(tr);
    });

    document.getElementById("total-calls").textContent = data.length;

    // Calculate average sentiment
    const sentiments = data
        .filter(row => row.sentiment_score !== null)
        .map(row => row.sentiment_score);

    const avg = sentiments.length
        ? (sentiments.reduce((a, b) => a + b, 0) / sentiments.length).toFixed(2)
        : "0";

    document.getElementById("avg-sentiment").textContent = avg;
}


// Load everything on page load
loadReservations();
loadCalls();
</script>

</body>
</html>
